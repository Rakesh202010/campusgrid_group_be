// Prisma schema for Group Backend (connects to admin DB for authentication)

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_ADMIN")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x", "darwin-arm64"]
}

model SchoolGroup {
  id                String   @id @default(uuid())
  groupName         String
  displayName       String
  subdomain         String   @unique
  dbName            String   @unique
  dbHost            String
  dbUser            String
  dbPassword        String
  status            String
  
  admins            GroupAdmin[]
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([subdomain])
  @@index([status])
}

model GroupAdmin {
  id                String      @id @default(uuid())
  email             String      @unique
  password          String
  name              String
  role              String      @default("admin")
  groupId           String
  group             SchoolGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  
  isActive          Boolean     @default(true)
  lastLogin         DateTime?
  
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  @@index([email])
  @@index([groupId])
}
